!function(factory){if("function"==typeof define&&define.amd)define(["leaflet"],factory);else if("object"==typeof exports)module.exports=factory(require("leaflet"));else if("undefined"!=typeof window){if(void 0===window.L)throw"Leaflet must be loaded first.";window.L.Control.SimpleLocate=factory(window.L)}}(function(L){let SimpleLocate=L.Control.extend({options:{className:"",title:"Locate Geolocation and Orientation",ariaLabel:"",minAngleChange:3,clickTimeoutDelay:500,setViewAfterClick:!0,zoomLevel:void 0,drawCircle:!0,afterClick:null,afterMarkerAdd:null,afterDeviceMove:null,htmlInit:`
<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
	<path d="M 8,1.5 A 6.5,6.5 0 0 0 1.5,8 6.5,6.5 0 0 0 8,14.5 6.5,6.5 0 0 0 14.5,8 6.5,6.5 0 0 0 8,1.5 Z m 0,2 A 4.5,4.5 0 0 1 12.5,8 4.5,4.5 0 0 1 8,12.5 4.5,4.5 0 0 1 3.5,8 4.5,4.5 0 0 1 8,3.5 Z" />
	<rect width="1.5" height="4" x="7.25" y="0.5" rx="0.5" ry="0.5" />
	<rect width="1.5" height="4" x="7.25" y="11.5" rx="0.5" ry="0.5" />
	<rect width="4" height="1.5" x="0.5" y="7.25" rx="0.5" ry="0.5" />
	<rect width="4" height="1.5" x="11.5" y="7.25" ry="0.5" rx="0.5" />
	<circle cx="8" cy="8" r="1" />
</svg>`,htmlSpinner:`
<svg width="16" height="16" viewBox="-8 -8 16 16" xmlns="http://www.w3.org/2000/svg">
	<g>
		<circle opacity=".7" cx="0" cy="-6" r=".9" transform="rotate(90)" />
		<circle opacity=".9" cx="0" cy="-6" r="1.3" transform="rotate(45)" />
		<circle opacity="1" cx="0" cy="-6" r="1.5" />
		<circle opacity=".95" cx="0" cy="-6" r="1.42" transform="rotate(-45)" />
		<circle opacity=".85" cx="0" cy="-6" r="1.26" transform="rotate(-90)" />
		<circle opacity=".7" cx="0" cy="-6" r="1.02" transform="rotate(-135)" />
		<circle opacity=".5" cx="0" cy="-6" r=".7" transform="rotate(-180)" />
		<circle opacity=".25" cx="0" cy="-6" r=".3" transform="rotate(-225)" />
		<animateTransform attributeName="transform" type="rotate" values="0;0;45;45;90;90;135;135;180;180;225;225;270;270;315;315;360" keyTimes="0;.125;.125;.25;.25;.375;.375;.5;.5;.675;.675;.75;.75;.875;.875;1;1" dur="1.3s" repeatCount="indefinite" />
	</g>
</svg>`,htmlGeolocation:`
<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
	<path d="M 13.329384,2.6706085 C 13.133096,2.4743297 12.77601,2.4382611 12.303066,2.6103882 L 6.6307133,4.6742285 1.1816923,6.6577732 C 1.0668479,6.6995703 0.95157337,6.752486 0.83540381,6.8133451 0.27343954,7.1201064 0.41842508,7.4470449 1.2644998,7.5962244 l 6.0688263,1.0701854 1.0714872,6.0698222 c 0.1491847,0.84604 0.4751513,0.990031 0.7816575,0.427825 0.060857,-0.116165 0.1137803,-0.231436 0.1555779,-0.346273 L 11.324426,9.3702482 13.389608,3.6968841 C 13.56174,3.2239596 13.52567,2.8668883 13.329392,2.6706094 Z" />
</svg>`,htmlOrientation:`
<svg class="leaflet-simple-locate-orientation" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
	<path fill="#c00000" d="M 8,0 C 7.7058986,0 7.4109021,0.30139625 7.1855469,0.90234375 L 5.3378906,5.8300781 C 5.2559225,6.0486598 5.1908259,6.292468 5.1386719,6.5507812 6.0506884,6.193573 7.0205489,6.0068832 8,6 8.9768002,6.0005071 9.945249,6.1798985 10.857422,6.5292969 10.805917,6.2790667 10.741782,6.0425374 10.662109,5.8300781 L 8.8144531,0.90234375 C 8.5890978,0.30139615 8.2941007,0 8,0 Z" />
	<path d="M 8,5.9999998 C 7.0205501,6.006884 6.0506874,6.1935733 5.138672,6.5507817 4.9040515,7.7126196 4.9691485,9.1866095 5.3378906,10.169922 l 1.8476563,4.927734 c 0.4507105,1.201895 1.1781958,1.201894 1.628906,0 L 10.662109,10.169922 C 11.033147,9.1804875 11.097283,7.6944254 10.857422,6.5292967 9.9452497,6.1798989 8.9767993,6.0005076 8,5.9999998 Z m -1e-7,0.7499999 A 1.25,1.258 90 0 1 9.2578124,7.9999996 1.25,1.258 90 0 1 8,9.2500001 a 1.25,1.258 90 0 1 -1.2578124,-1.25 1.25,1.258 90 0 1 1.2578123,-1.2500004 z" />
</svg>`,iconGeolocation:L.divIcon({html:`
<svg width="24" height="24" viewBox="-12 -12 24 24" xmlns="http://www.w3.org/2000/svg">
	<defs>
		<filter id="gaussian">
			<feGaussianBlur stdDeviation="0.5" />
		</filter>
	</defs>
	<g id="leaflet-simple-locate-icon-spot">
		<circle fill="#000000" style="opacity:0.3;filter:url(#gaussian)" cx="1" cy="1" r="10" />
		<circle fill="#ffffff" r="10" />
		<circle r="6">
			<animate attributeName="r" values="6;8;6" dur="2s" repeatCount="indefinite" />
		</circle>
	</g>
</svg>`,className:"leaflet-simple-locate-icon",iconSize:[24,24],iconAnchor:[12,12]}),iconOrientation:L.divIcon({html:`
<svg width="96" height="96" viewBox="-48 -48 96 96" xmlns="http://www.w3.org/2000/svg">
	<defs>
		<linearGradient id="gradient" x2="0" y2="-48" gradientUnits="userSpaceOnUse">
			<stop style="stop-opacity:1" offset="0" />
			<stop style="stop-opacity:0" offset="1" />
		</linearGradient>
		<filter id="gaussian">
			<feGaussianBlur stdDeviation="0.5" />
		</filter>
	</defs>
	<path class="orientation" opacity="1" style="fill:url(#gradient)" d="M -24,-48 H 24 L 10,0 H -10 z">
		<animate attributeName="opacity" values=".75;.33;.75" dur="2s" repeatCount="indefinite" />
	</path>
	<g id="leaflet-simple-locate-icon-spot">
		<circle fill="#000000" style="opacity:0.3;filter:url(#gaussian)" cx="1" cy="1" r="10" />
		<circle fill="#ffffff" r="10" />
		<circle r="6">
			<animate attributeName="r" values="6;9;6" dur="2s" repeatCount="indefinite" />
		</circle>
	</g>
</svg>`,className:"leaflet-simple-locate-icon",iconSize:[96,96],iconAnchor:[48,48]})},initialize:function(options){L.Util.setOptions(this,options),this._map=void 0,this._button=void 0,this._marker=void 0,this._circle=void 0,this._clicked=void 0,this._geolocation=void 0,this._orientation=void 0,this._clickTimeout=void 0,this._latitude=void 0,this._longitude=void 0,this._accuracy=void 0,this._angle=void 0},onAdd:function(map){return this._map=map,this._button=L.DomUtil.create("button","leaflet-simple-locate"),this.options.className&&L.DomUtil.addClass(this._button,this.options.className),L.DomEvent.disableClickPropagation(this._button),this._button.innerHTML=this.options.htmlInit,this._button.title=this.options.title,this._button.setAttribute("aria-label",this.options.ariaLabel||this.options.title),L.DomEvent.on(this._button,"click",L.DomEvent.stopPropagation).on(this._button,"click",L.DomEvent.preventDefault).on(this._button,"click",this._onClick,this),this._button},getLatLng:function(){return this._latitude&&this._longitude?{lat:this._latitude,lng:this._longitude}:null},getAccuracy:function(){return this._accuracy||null},getAngle:function(){return this._angle||null},setZoomLevel:function(level){this.options.zoomLevel=level},_onClick:async function(){this._clickTimeout?(clearTimeout(this._clickTimeout),this._clickTimeout=void 0,this._clicked&&(this._geolocation&&this._unwatchGeolocation(),this._orientation&&this._unwatchOrientation(),this._clicked=void 0,this._geolocation=void 0,this._orientation=void 0,this._updateButton(),this._map.off("layeradd",this._onLayerAdd,this))):this._clickTimeout=setTimeout(()=>{clearTimeout(this._clickTimeout),this._clickTimeout=void 0,this._map&&(this._clicked&&this.options.setViewAfterClick?this._setView():(this._clicked=!0,this._updateButton(),this._map.on("layeradd",this._onLayerAdd,this),this._checkGeolocation().then(event=>{this._geolocation=!0,this._onLocationFound(event.coords),this.options.setViewAfterClick&&this._setView(),this._watchGeolocation(),this._checkClickResult()}).catch(()=>{this._geolocation=!1,this._checkClickResult()}),this._checkOrientation().then(()=>{this._orientation=!0,this._watchOrientation(),this._checkClickResult()}).catch(()=>{this._orientation=!1,this._checkClickResult()})))},this.options.clickTimeoutDelay)},_checkClickResult:function(){this._updateButton(),this.options.afterClick&&void 0!==this._geolocation&&void 0!==this._orientation&&this.options.afterClick({geolocation:this._geolocation,orientation:this._orientation}),!1===this._geolocation&&!1===this._orientation&&(this._clicked=void 0,this._geolocation=void 0,this._orientation=void 0)},_checkGeolocation:function(){return"object"==typeof navigator&&"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition?new Promise((resolve,reject)=>{navigator.geolocation.getCurrentPosition(resolve,reject,{maximumAge:0,enableHighAccuracy:!0})}):Promise.reject()},_checkOrientation:function(){return("ondeviceorientationabsolute"in window||"ondeviceorientation"in window)&&DeviceOrientationEvent?"function"!=typeof DeviceOrientationEvent.requestPermission?Promise.resolve():DeviceOrientationEvent.requestPermission().then(permission=>"granted"===permission||Promise.reject()):Promise.reject()},_watchGeolocation:function(){this._map.locate({watch:!0,enableHighAccuracy:!0}),this._map.on("locationfound",this._onLocationFound,this),this._map.on("zoomstart",this._onZoomStart,this),this._map.on("zoomend",this._onZoomEnd,this)},_unwatchGeolocation:function(){this._map.stopLocate(),this._map.off("locationfound",this._onLocationFound,this),this._map.off("zoomstart",this._onZoomStart,this),this._map.off("zoomend",this._onZoomEnd,this),this._circle&&(this._map.removeLayer(this._circle),this._circle=void 0),this._marker&&(this._map.removeLayer(this._marker),this._marker=void 0),this._latitude=void 0,this._longitude=void 0,this._accuracy=void 0},_watchOrientation:function(){L.DomEvent.on(window,"ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation",this._onOrientation,this)},_unwatchOrientation:function(){L.DomEvent.off(window,"ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation",this._onOrientation,this),document.documentElement.style.setProperty("--leaflet-simple-locate-orientation","0deg"),this._angle=void 0},_onLocationFound:function(event){this._latitude&&event.latitude&&Math.round(1e6*this._latitude)===Math.round(1e6*event.latitude)&&this._longitude&&event.longitude&&Math.round(1e6*this._longitude)===Math.round(1e6*event.longitude)&&this._accuracy&&event.accuracy&&Math.round(100*this._accuracy)===Math.round(100*event.accuracy)||(this._latitude=event.latitude,this._longitude=event.longitude,this._accuracy=event.accuracy,this._updateMarker())},_onOrientation:function(event){let angle;angle=event.webkitCompassHeading||360-event.alpha,this._angle&&Math.abs(angle-this._angle)<this.options.minAngleChange||(this._angle=angle,"orientation"in screen&&(this._angle+=screen.orientation.angle),this._angle=(this._angle+360)%360,document.documentElement.style.setProperty("--leaflet-simple-locate-orientation",-this._angle+"deg"),this._updateMarker())},_onZoomStart:function(){this._circle&&document.documentElement.style.setProperty("--leaflet-simple-locate-circle-display","none")},_onZoomEnd:function(){this._circle&&document.documentElement.style.setProperty("--leaflet-simple-locate-circle-display","inline")},_onLayerAdd:function(event){this.options.afterMarkerAdd&&event.layer==this._marker&&this.options.afterMarkerAdd()},_setView:function(){this._map&&this._latitude&&this._longitude&&(this.options.zoomLevel?this._map.setView([this._latitude,this._longitude],this.options.zoomLevel):this._map.setView([this._latitude,this._longitude]))},_updateButton:function(){this._clicked?void 0===this._geolocation||void 0===this._orientation?"spinner"!==this._button.html_name&&(this._button.innerHTML=this.options.htmlSpinner,this._button.html_name="spinner"):this._orientation&&"orientation"!==this._button.html_name?(this._button.innerHTML=this.options.htmlOrientation,this._button.html_name="orientation"):this._geolocation&&"geolocation"!==this._button.html_name&&(this._button.innerHTML=this.options.htmlGeolocation,this._button.html_name="geolocation"):"init"!==this._button.html_name&&(this._button.innerHTML=this.options.htmlInit,this._button.html_name="init")},_updateMarker:function(){if(this.options.afterDeviceMove&&this.options.afterDeviceMove({lat:this._latitude,lng:this._longitude,accuracy:this._accuracy,angle:this._angle}),this._latitude&&this._longitude&&(!this.options.drawCircle||this._accuracy)){let icon_name;if(this._geolocation&&this._orientation&&this._angle)icon_name="iconOrientation";else{if(!this._geolocation)return;icon_name="iconGeolocation"}this._circle?(this._circle.setLatLng([this._latitude,this._longitude]),this._circle.setRadius(this._accuracy)):this.options.drawCircle&&(this._circle=L.circle([this._latitude,this._longitude],{className:"leaflet-simple-locate-circle",radius:this._accuracy}).addTo(this._map)),this._marker&&this._marker.icon_name===icon_name?this._marker.setLatLng([this._latitude,this._longitude]):(this._marker&&this._map.removeLayer(this._marker),this._marker=L.marker([this._latitude,this._longitude],{icon:this.options[icon_name]}),this._marker.icon_name=icon_name,this._marker.addTo(this._map))}}});return L.control.simpleLocate=function(options){return new SimpleLocate(options)},SimpleLocate});